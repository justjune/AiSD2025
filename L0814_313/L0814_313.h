#ifndef L0814_313_H
#define L0814_313_H

#include <vector>
#include <queue>
#include <climits>
#include <iostream>

using namespace std;

/*
 Edge - Структура для представления ребра в графе потока
 Ребро хранит информацию о потоке, пропускной способности и остаточной пропускной способности
*/
struct Edge
{
    int v;                   // <-- Соседняя вершина, в которую ведет ребро
    int capacity;            // <-- Максимальная пропускная способность ребра
    int flow;                // <-- Текущий поток через ребро
    int residual;            // <-- Остаточная пропускная способность
    Edge* next;              // <-- Указатель на следующее ребро в списке
    Edge* reverse;           // <-- Указатель на обратное ребро (для остаточного графа)


    Edge(int vertex, int cap) : v(vertex), capacity(cap), flow(0),
                                residual(cap), next(nullptr), reverse(nullptr) {}
    /*
     Конструктор ребра
     Параметры:
       vertex - Соседняя вершина
       cap    - Пропускная способность
     */
};

/*
 FlowGraph - Класс для представления графа потока и работы с алгоритмами поиска максимального потока
 
 Этот класс реализует алгоритм поиска максимального потока методом Форда-Фалкерсона с использованием BFS (алгоритм Эдмондса-Карпа)
 */
class FlowGraph
{
    private:
        int nvertices;                      // <-- Количество вершин в графе
        vector<Edge*> edges;                // <-- Список смежности (массив указателей на ребра)
        vector<int> parent;                 // <-- Массив родителей для восстановления пути
        vector<bool> discovered;            // <-- Массив посещенных вершин

    public:

        FlowGraph(int vertices);
        /*
         Конструктор графа потока
         Параметры:
            vertices - Количество вершин
         */
    
    
        ~FlowGraph();
        /*
         Деструктор - освобождает память
         */

    
        void addEdge(int from, int to, int capacity);
        /*
         Добавление ребра в граф
         Параметры:
            from     - Начальная вершина
            to       - Конечная вершина
            capacity - Пропускная способность
     
         Создает прямое и обратное ребро для остаточного графа
         */

        void initializeSearch();
        /*
         Инициализация поиска
         
         Подготавливает массивы для нового поиска в ширину
         */


        void bfs(int source);
        /*
         Поиск в ширину (BFS) для нахождения увеличивающего пути
         Параметры:
            source - Исток (начальная вершина)
         
         Находит путь от истока к стоку с положительной остаточной пропускной способностью
         */
    


        int pathVolume(int source, int sink);
        /*
         Вычисление объема (пропускной способности) пути
         Параметры:
            source - Исток
            sink   - Сток
         (return) Минимальная остаточная пропускная способность на пути
         
        Проходит по пути от стока к истоку и находит минимальную остаточную пропускную способность
         */


        void augmentPath(int source, int sink, int volume);
        /*
         Увеличение потока вдоль найденного пути
         Параметры:
            source - Исток
            sink   - Сток
            volume - Объем потока для добавления
         
         Увеличивает поток вдоль пути и уменьшает остаточную пропускную способность
         */


        int netflow(int source, int sink);
        /*
         Основная функция поиска максимального потока
         Параметры:
            source - Исток
            sink   - Сток
         (return) Значение максимального потока
         
         Реализует алгоритм Эдмондса-Карпа:
            1. Пока существует увеличивающий путь от истока к стоку
            2. Находим минимальную пропускную способность на пути
            3. Увеличиваем поток вдоль этого пути
         */


        void printGraph() const;
        /*
         Вывод информации о графе
         */


        void printFlows() const;
        /*
         Вывод информации о потоках
         */
};

#endif // L0814_313_H
